<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Заказ автомобилей из Европы - CarExport</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="images/logo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="premium">
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="images/logo.png" alt="CarExport" class="logo-img">
                    <span>CarExport</span>
                </div>
                <nav class="nav">
                    <a href="index.html#catalog">Грузия</a>
                    <a href="usa-orders.html">США</a>
                    <a href="china-orders.html">Китай</a>
                    <a href="korea-orders.html">Корея</a>
                    <a href="#europe-orders" class="active">Европа</a>
                    <a href="#" onclick="openCustomsModal(); return false;">Таможенный калькулятор</a>
                </nav>
                <div class="header-actions">
                    <button class="cart-btn" id="cartBtn">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </button>
                    <button class="btn-secondary" type="button" onclick="openRequestModal()">Заявка на подбор</button>
                    <button class="btn-primary" type="button" onclick="openSelfCalcModal()">Самостоятельный просчет</button>
                </div>
            </div>
        </div>
    </header>

    <section class="hero" style="background:#1a1f2e;color:#f3f4f6;border-bottom:1px solid #1f2937;">
        <div class="container">
            <div class="hero-content">
                <h1>Заказ автомобилей из Европы</h1>
                <p>Широкий выбор качественных автомобилей из Германии, Франции, Италии и других европейских стран. Официальные дилеры, проверенная история, доставка и растаможка под ключ в Россию.</p>
                <div class="hero-features">
                    <div class="feature">
                        <i class="fas fa-file-signature"></i>
                        <span>Проверенная история</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-car-side"></i>
                        <span>Официальные дилеры</span>
                    </div>
                </div>
                <button class="cta-btn" onclick="document.getElementById('europe-orders').scrollIntoView({behavior:'smooth'});">
                    Смотреть предложения
                </button>
            </div>
        </div>
    </section>

    <section id="europe-orders" class="usa-orders">
        <div class="container">
            <div class="usa-header">
                <div>
                    <h2>Автомобили из Европы в наличии</h2>
                    <p>Широкий выбор качественных автомобилей из Германии, Франции, Италии и других европейских стран. Официальные дилеры, проверенная история, доставка и растаможка под ключ.</p>
                </div>
                <div class="usa-badges">
                    <span class="usa-badge">Проверенная история</span>
                    <span class="usa-badge">Официальные дилеры</span>
                </div>
            </div>

            <div class="usa-metrics" id="europeMetrics" aria-live="polite">
                <div class="usa-metric">
                    <span class="usa-metric-label">Авто в каталоге</span>
                    <span class="usa-metric-value" data-metric="count">—</span>
                </div>
                <div class="usa-metric">
                    <span class="usa-metric-label">Средний бюджет</span>
                    <span class="usa-metric-value" data-metric="avg">—</span>
                </div>
                <div class="usa-metric">
                    <span class="usa-metric-label">Минимальная цена</span>
                    <span class="usa-metric-value" data-metric="min">—</span>
                </div>
            </div>

            <div class="korea-filters" aria-label="Фильтры каталога">
                <div class="filter-group">
                    <label for="europeBrandFilter">Марка</label>
                    <select id="europeBrandFilter">
                        <option value="">Все марки</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="europeModelSearch">Модель</label>
                    <input type="text" id="europeModelSearch" placeholder="Например, BMW">
                </div>
                <div class="filter-group">
                    <label for="europeSort">Сортировка</label>
                    <select id="europeSort">
                        <option value="default">По умолчанию</option>
                        <option value="price-asc">Цена: по возрастанию</option>
                        <option value="price-desc">Цена: по убыванию</option>
                        <option value="name-asc">Название: А→Я</option>
                        <option value="name-desc">Название: Я→А</option>
                    </select>
                </div>
                <button class="filter-btn" id="europeResetFilters" type="button">Сбросить</button>
            </div>

            <div class="usa-orders-grid" id="europeGrid">
                <div class="usa-empty-state" id="europeLoadingIndicator">Загружаем предложения...</div>
            </div>

            <p class="usa-note">Цены указаны ориентировочно. Для точного предложения оставьте заявку — проверим доступность, историю и рассчитаем доставку до вашего города.</p>
        </div>
    </section>

    <section id="contact" class="contact">
        <div class="container">
            <h2>Контакты</h2>
            <div class="contact-content">
                <div class="contact-info">
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <div>
                            <h4>Телефон</h4>
                            <p>+7 (915) 444-12-08</p>
                            <p>+7 (918) 414-06-36</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <h4>Email</h4>
                            <p>carexportgeo@bk.ru</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <i class="fab fa-telegram"></i>
                        <div>
                            <h4>Telegram</h4>
                            <p><a href="https://t.me/Aleksandr_N_444" target="_blank">@Aleksandr_N_444</a></p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <i class="fab fa-whatsapp"></i>
                        <div>
                            <h4>WhatsApp</h4>
                            <p><a href="https://wa.me/79184140636" target="_blank">+7-918-414-06-36</a></p>
                        </div>
                    </div>
                </div>
                <div class="contact-form">
                    <h3>Оставить заявку</h3>
                    <form id="contactForm">
                        <input type="text" placeholder="Ваше имя" required>
                        <input type="tel" placeholder="Телефон" required>
                        <input type="email" placeholder="Email">
                        <textarea placeholder="Сообщение"></textarea>
                        <button type="submit">Отправить</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>CarExport</h4>
                    <p>Проверенные автомобили из Европы с доставкой и оформлением «под ключ»</p>
                </div>
                <div class="footer-section">
                    <h4>Услуги</h4>
                    <ul>
                        <li>Проверка по европейским базам</li>
                        <li>Логистика и таможенное оформление</li>
                        <li>Сертификация и постановка на учет</li>
                        <li>Гарантийная поддержка</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Контакты</h4>
                    <p>+7 (915) 444-12-08</p>
                    <p>+7 (918) 414-06-36</p>
                    <p>carexportgeo@bk.ru</p>
                </div>
                <div class="footer-section">
                    <h4>Соцсети</h4>
                    <p><a href="https://t.me/Aleksandr_N_444" target="_blank">Telegram</a></p>
                    <p><a href="https://wa.me/79184140636" target="_blank">WhatsApp</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2024 CarExport. Все права защищены.</p>
            </div>
        </div>
    </footer>

    <!-- Модальные окна (те же что в index.html) -->
    <div id="cartModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ваш заказ</h3>
                <span class="close" onclick="closeCart()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="cartBody"></div>
            </div>
            <div class="modal-footer">
                <div class="cart-summary">
                    <span>Итого: <strong id="cartTotal">0</strong> ₽</span>
                </div>
                <button class="btn-primary" onclick="checkout()">Оформить заказ</button>
            </div>
        </div>
    </div>

    <div id="checkoutModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Контактные данные</h3>
                <span class="close" onclick="closeCheckoutModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="checkoutContactForm">
                    <label for="contactName">Имя</label>
                    <input type="text" id="contactName" required>
                    <label for="contactPhone">Телефон</label>
                    <input type="tel" id="contactPhone" required>
                    <label for="contactEmail">Email</label>
                    <input type="email" id="contactEmail" required>
                    <button type="submit" class="btn-primary" style="margin-top:1rem;">Отправить</button>
                </form>
                <form id="emailFallbackForm" action="https://formsubmit.co/carexportgeo@bk.ru" method="POST" style="display:none;">
                    <input type="hidden" name="name" id="fs_name">
                    <input type="hidden" name="phone" id="fs_phone">
                    <input type="hidden" name="email" id="fs_email">
                    <input type="hidden" name="message" id="fs_message">
                    <input type="hidden" name="_captcha" value="false">
                    <input type="hidden" name="_subject" value="Новый заказ с сайта CarExport">
                </form>
            </div>
        </div>
    </div>

    <div id="customsModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Таможенный калькулятор</h3>
                <span class="close" onclick="closeCustomsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="customs-content">
                    <form id="customsForm" class="calc-form" onsubmit="return false;">
                        <div class="calc-row">
                            <label for="costUsd">Стоимость (USD)</label>
                            <input type="number" id="costUsd" placeholder="Например, 35000" min="0" step="0.01" required>
                        </div>
                        <div class="calc-row">
                            <label for="engineCc">Объем, см³</label>
                            <input type="number" id="engineCc" placeholder="Например, 2497" min="0" step="1" required>
                        </div>
                        <div class="calc-row">
                            <label for="age">Возраст</label>
                            <input id="age" value="До 3 лет" disabled>
                        </div>
                        <div class="calc-actions">
                            <button class="btn-primary" id="calcBtn" type="button">Рассчитать</button>
                        </div>
                    </form>
                    <div class="calc-result" id="calcResult" aria-live="polite"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="requestModal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width:600px;">
            <div class="modal-header">
                <h3>Заявка на подбор</h3>
                <span class="close" onclick="closeRequestModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="request-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reqBrand">Марка*</label>
                            <input type="text" id="reqBrand" required>
                        </div>
                        <div class="form-group">
                            <label for="reqModel">Модель*</label>
                            <input type="text" id="reqModel" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reqYearFrom">Год от</label>
                            <input type="number" id="reqYearFrom" min="1990" max="2025">
                        </div>
                        <div class="form-group">
                            <label for="reqYearTo">Год до</label>
                            <input type="number" id="reqYearTo" min="1990" max="2025">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reqPriceTo">Бюджет до, ₽</label>
                        <input type="number" id="reqPriceTo" min="0">
                    </div>
                    <div class="form-group">
                        <label for="reqName">Ваше имя*</label>
                        <input type="text" id="reqName" required>
                    </div>
                    <div class="form-group">
                        <label for="reqPhone">Телефон*</label>
                        <input type="tel" id="reqPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="reqEmail">Email</label>
                        <input type="email" id="reqEmail">
                    </div>
                    <div class="form-group">
                        <label for="reqNote">Комментарий</label>
                        <textarea id="reqNote" rows="4"></textarea>
                    </div>
                    <div id="requestStatus" style="display:none;color:#facc15;margin-bottom:1rem;"></div>
                    <button class="btn-primary" id="requestSubmit" type="button">Отправить</button>
                </div>
            </div>
        </div>
    </div>

    <div id="selfCalcModal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width:600px;">
            <div class="modal-header">
                <h3>Самостоятельный просчет</h3>
                <span class="close" onclick="closeSelfCalcModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="calc-form">
                    <div class="calc-row">
                        <label for="selfCostUsd">Стоимость авто (USD)</label>
                        <input type="number" id="selfCostUsd" min="0" step="0.01" placeholder="Например, 42000">
                    </div>
                    <div class="calc-row">
                        <label for="selfEngineCc">Объем двигателя, см³</label>
                        <input type="number" id="selfEngineCc" min="0" step="1" placeholder="Например, 2497">
                    </div>
                    <button class="btn-primary" id="selfCalcBtn" type="button">Рассчитать</button>
                    <div class="calc-result" id="selfCalcResult" aria-live="polite"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Загрузка данных о европейских автомобилях
        (async function() {
            const loadingIndicator = document.getElementById('europeLoadingIndicator');
            
            try {
                const response = await fetch('./cars_europe.json');
                if (!response.ok) throw new Error('Failed to load Europe data');
                const data = await response.json();
                window.europeCarsData = data;
                
                // Функция для отображения автомобилей
                function renderEuropeCars(cars) {
                    const grid = document.getElementById('europeGrid');
                    if (!grid) return;
                    
                    if (cars.length === 0) {
                        grid.innerHTML = '<div class="usa-empty-state">Автомобили не найдены</div>';
                        return;
                    }
                    
                    grid.innerHTML = cars.map(car => {
                        // Форматирование цены - проверяем на разумность
                        let price = 'Цена по запросу';
                        if (car.price && car.price > 0 && car.price <= 50000000) {
                            price = `${new Intl.NumberFormat('ru-RU').format(Math.round(car.price))} €`;
                        }
                        
                        // Фильтруем изображения - только jpg и jpeg (фотографии автомобилей)
                        let filteredImages = (car.images || []).filter(img => {
                            if (!img) return false;
                            const imgLower = img.toLowerCase();
                            // Пропускаем служебные изображения
                            const exclude = ['webp', 'logo', 'icon', 'map', 'banner', 'static', 'modal', 'subscribe'];
                            // Исключаем только если это явно служебное изображение, не исключаем все png
                            if (exclude.some(kw => imgLower.includes(kw))) return false;
                            // Берем только jpg/jpeg (png могут быть фотографиями, но обычно это иконки/графика)
                            return imgLower.endsWith('.jpg') || imgLower.endsWith('.jpeg');
                        });
                        
                        // Берем первое подходящее изображение
                        const mainImage = filteredImages.length > 0 
                            ? `images/${filteredImages[0]}` 
                            : 'images/logo.png';
                        
                        return `
                            <div class="usa-order-card">
                                <div class="usa-order-image">
                                    <img src="${mainImage}" alt="${car.fullName || car.brand + ' ' + car.model}" 
                                         onerror="this.src='images/logo.png'"
                                         style="width: 100%; height: 200px; object-fit: cover;">
                                </div>
                                <div class="usa-order-info">
                                    <h3>${car.fullName || car.brand + ' ' + car.model}</h3>
                                    <div class="usa-order-specs">
                                        ${car.year ? `<span><i class="fas fa-calendar"></i> ${car.year}</span>` : ''}
                                        ${car.mileage ? `<span><i class="fas fa-tachometer-alt"></i> ${new Intl.NumberFormat('ru-RU').format(car.mileage)} км</span>` : ''}
                                        ${car.engine ? `<span><i class="fas fa-cog"></i> ${car.engine} л</span>` : ''}
                                        ${car.power ? `<span><i class="fas fa-bolt"></i> ${car.power} л.с.</span>` : ''}
                                    </div>
                                    <div class="usa-order-price">${price}</div>
                                    <button class="btn-primary" onclick="openRequestModal()">Оставить заявку</button>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                // Обновление метрик
                function updateMetrics(cars) {
                    const metrics = document.getElementById('europeMetrics');
                    if (!metrics) return;
                    
                    const countEl = metrics.querySelector('[data-metric="count"]');
                    const avgEl = metrics.querySelector('[data-metric="avg"]');
                    const minEl = metrics.querySelector('[data-metric="min"]');
                    
                    if (countEl) countEl.textContent = cars.length;
                    
                    const prices = cars.filter(c => c.price).map(c => c.price);
                    if (prices.length > 0) {
                        const avg = prices.reduce((a, b) => a + b, 0) / prices.length;
                        const min = Math.min(...prices);
                        if (avgEl) avgEl.textContent = `${new Intl.NumberFormat('ru-RU').format(Math.round(avg))} €`;
                        if (minEl) minEl.textContent = `${new Intl.NumberFormat('ru-RU').format(Math.round(min))} €`;
                    }
                }
                
                // Фильтрация и сортировка
                function filterAndRender() {
                    const brandFilter = document.getElementById('europeBrandFilter');
                    const modelSearch = document.getElementById('europeModelSearch');
                    const sortSelect = document.getElementById('europeSort');
                    
                    let filtered = [...window.europeCarsData];
                    
                    if (brandFilter && brandFilter.value) {
                        filtered = filtered.filter(c => c.brand === brandFilter.value);
                    }
                    
                    if (modelSearch && modelSearch.value) {
                        const search = modelSearch.value.toLowerCase();
                        filtered = filtered.filter(c => 
                            (c.model && c.model.toLowerCase().includes(search)) ||
                            (c.fullName && c.fullName.toLowerCase().includes(search))
                        );
                    }
                    
                    // Сортировка
                    if (sortSelect && sortSelect.value !== 'default') {
                        filtered.sort((a, b) => {
                            switch(sortSelect.value) {
                                case 'price-asc':
                                    return (a.price || 0) - (b.price || 0);
                                case 'price-desc':
                                    return (b.price || 0) - (a.price || 0);
                                case 'name-asc':
                                    return (a.fullName || '').localeCompare(b.fullName || '');
                                case 'name-desc':
                                    return (b.fullName || '').localeCompare(a.fullName || '');
                                default:
                                    return 0;
                            }
                        });
                    }
                    
                    renderEuropeCars(filtered);
                    updateMetrics(filtered);
                }
                
                // Заполнение фильтра марок
                function populateBrandFilter() {
                    const brandFilter = document.getElementById('europeBrandFilter');
                    if (!brandFilter) return;
                    
                    const brands = [...new Set(window.europeCarsData.map(c => c.brand).filter(Boolean))].sort();
                    brands.forEach(brand => {
                        const option = document.createElement('option');
                        option.value = brand;
                        option.textContent = brand;
                        brandFilter.appendChild(option);
                    });
                }
                
                // Инициализация
                function initEuropeSection() {
                    populateBrandFilter();
                    filterAndRender();
                    
                    document.getElementById('europeBrandFilter')?.addEventListener('change', filterAndRender);
                    document.getElementById('europeModelSearch')?.addEventListener('input', filterAndRender);
                    document.getElementById('europeSort')?.addEventListener('change', filterAndRender);
                    document.getElementById('europeResetFilters')?.addEventListener('click', () => {
                        document.getElementById('europeBrandFilter').value = '';
                        document.getElementById('europeModelSearch').value = '';
                        document.getElementById('europeSort').value = 'default';
                        filterAndRender();
                    });
                    
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }
                }
                
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', initEuropeSection);
                } else {
                    initEuropeSection();
                }
            } catch (error) {
                console.error('Error loading Europe catalog:', error);
                window.europeCarsData = [];
                if (loadingIndicator) {
                    loadingIndicator.textContent = 'Ошибка загрузки каталога. Пожалуйста, обновите страницу.';
                }
            }
        })();
    </script>
    <aside class="floating-subscribe" aria-label="Подписка на Telegram">
        <div class="floating-subscribe__inner">
            <span class="floating-subscribe__title"><i class="fab fa-telegram"></i> Подпишись на нас в Telegram</span>
            <a class="floating-subscribe__link" href="https://t.me/expo_mir" target="_blank" rel="noopener">Перейти в канал</a>
            <button class="floating-subscribe__close" type="button" aria-label="Закрыть уведомление">&times;</button>
        </div>
    </aside>
    <script>
        (function(){
            const widget = document.querySelector('.floating-subscribe');
            if (!widget) return;
            const closeBtn = widget.querySelector('.floating-subscribe__close');
            if (closeBtn) {
                closeBtn.addEventListener('click', function(){
                    widget.classList.add('floating-subscribe--hidden');
                    localStorage.setItem('ce_subscribe_closed', '1');
                });
            }
            if (localStorage.getItem('ce_subscribe_closed') === '1') {
                widget.classList.add('floating-subscribe--hidden');
            }
        })();
    </script>
</body>
</html>
